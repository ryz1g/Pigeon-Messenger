#:import threading threading
#:import Factory kivy.factory.Factory

<Button>
    font_name:"Fonts/Oswald-VariableFont_wght.ttf"

<Label>
    font_name:"Fonts/Oswald-VariableFont_wght.ttf"

<TextInput>
    font_name:"Fonts/Oswald-VariableFont_wght.ttf"

<ToggleButton>
    font_name:"Fonts/Oswald-VariableFont_wght.ttf"

ScreenManager:
    id:manager

    Screen:
        name:"home_layout"

        AnchorLayout:
            anchor_x:"center"
            anchor_y:"center"

            BoxLayout:
                orientation:"vertical"
                size_hint:(1,0.3)

                Label:
                    text:"Enter IP Address!"

                TextInput:
                    id:ip_enter
                    size_hint:(1,0.35)
                    halign:"center"
                    multiline:False

                Button:
                    text:"Start"
                    on_press:
                        threading.Thread(target=app.clock, args=(header,), daemon=True).start()
                        app.initialize(disp)
                        header.text="            IP:"+ip_enter.text+"            Time:00:00:00"
                        ip_enter.text=""
                        manager.current="chat_layout"

    Screen:
        name:"chat_layout"

        AnchorLayout:
            size: root.width, root.height
            anchor_x:"center"
            anchor_y:"center"
            Image:
                source:"Images/bg.jpg"
                allow_stretch:True
                keep_ratio:False
            BoxLayout:
                orientation:"horizontal"

                GridLayout:
                    cols:1
                    rows:3

                    BoxLayout:
                        orientation:"horizontal"
                        size_hint: (1,0.05)

                        Button:
                            text:"Back"
                            size_hint: (0.2,1)
                            pos_hint:{"top":1}
                            on_press:
                                manager.current="home_layout"
                                app.clear_chat()

                        Label:
                            id:header
                            text:"            IP:192.168.0.1            Time:00:00:00"
                            color: (1,1,1,1)
                            pos_hint: {"top":1,'center_x':0.5}
                            font_size: 25
                            italic:True

                    ScrollView:
                        BoxLayout:
                            id:disp
                            orientation:"vertical"
                            spacing:8
                            padding:10
                            size_hint:(1,None)
                            height:4000

                    BoxLayout:
                        orientation:"horizontal"
                        size_hint: (1,0.07)
                        padding:2
                        spacing:5

                        TextInput:
                            id:t_input
                            text:"default"
                            font_size:19
                            multiline:False
                            halign:"right"

                        Button:
                            text:"Send"
                            size_hint: 0.2,1
                            font_size:16
                            on_press:app.send(t_input)

                        Button:
                            text:"Image"
                            size_hint: 0.2,1
                            font_size:16
                            on_press:Factory.MyPop().open()

                        Button:
                            text:"Send2"
                            size_hint: 0.2,1
                            font_size:16
                            on_press:
                                app.send2(t_input)
        Screen:
        name:"call"

        BoxLayout:
            BoxLayout:
            orientation:"vertical"
            

<MyPop@Popup>
    auto_dismiss: True
    title: "                                                     Choose Image!"
    size_hint:(0.9,0.7)
    pos_hint: {'center_x':0.5, 'center_y':0.5}
    BoxLayout:
        orientation: "vertical"
        spacing:2

        FileChooserListView:
            id:fc

        GridLayout:
            cols:2
            size_hint:(1,0.1)
            Button:
                text:"Send"
                size_hint: (0.5,0.2)
                on_press:
                    app.send_selected(fc.selection)
                    root.dismiss()
            Button:
                text:"Close"
                size_hint: (0.5,0.2)
                on_press: root.dismiss()
